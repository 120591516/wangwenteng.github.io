<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Protocol Buffers V3指南[翻译] | 腾哥的学习笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/style.css">
    <script charset="utf-8" src="/js/custom.js"></script>
    <meta name="description" content="~~~学习过程中笔记心得整理~~~">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="robots" content="all">
    <meta name="author" content="腾哥">
    
    <link rel="preload" href="/assets/css/0.styles.5e2bd223.css" as="style"><link rel="preload" href="/assets/js/app.05769872.js" as="script"><link rel="preload" href="/assets/js/4.14868eff.js" as="script"><link rel="preload" href="/assets/js/1.4ea549be.js" as="script"><link rel="preload" href="/assets/js/120.a4ac45ec.js" as="script"><link rel="preload" href="/assets/js/11.fc56e899.js" as="script"><link rel="prefetch" href="/assets/js/10.b0b31219.js"><link rel="prefetch" href="/assets/js/100.d59649dd.js"><link rel="prefetch" href="/assets/js/101.55e0b3de.js"><link rel="prefetch" href="/assets/js/102.9be95467.js"><link rel="prefetch" href="/assets/js/103.aab6c132.js"><link rel="prefetch" href="/assets/js/104.cb71c347.js"><link rel="prefetch" href="/assets/js/105.86b761b7.js"><link rel="prefetch" href="/assets/js/106.63b6bcd1.js"><link rel="prefetch" href="/assets/js/107.6326c2a5.js"><link rel="prefetch" href="/assets/js/108.ad6922d7.js"><link rel="prefetch" href="/assets/js/109.5547b22e.js"><link rel="prefetch" href="/assets/js/110.1cd3e949.js"><link rel="prefetch" href="/assets/js/111.920b3633.js"><link rel="prefetch" href="/assets/js/112.b7563adf.js"><link rel="prefetch" href="/assets/js/113.3f94fda3.js"><link rel="prefetch" href="/assets/js/114.6f40204b.js"><link rel="prefetch" href="/assets/js/115.818e3eb7.js"><link rel="prefetch" href="/assets/js/116.1a79b49c.js"><link rel="prefetch" href="/assets/js/117.66de33c6.js"><link rel="prefetch" href="/assets/js/118.d2dd0787.js"><link rel="prefetch" href="/assets/js/119.911a9fda.js"><link rel="prefetch" href="/assets/js/12.c736dbaf.js"><link rel="prefetch" href="/assets/js/121.501acc1a.js"><link rel="prefetch" href="/assets/js/122.43b0ca5a.js"><link rel="prefetch" href="/assets/js/123.95e35ff6.js"><link rel="prefetch" href="/assets/js/124.b94580f2.js"><link rel="prefetch" href="/assets/js/125.a7d45e1d.js"><link rel="prefetch" href="/assets/js/126.1a75fefe.js"><link rel="prefetch" href="/assets/js/127.d6eec92f.js"><link rel="prefetch" href="/assets/js/128.7b8c4d70.js"><link rel="prefetch" href="/assets/js/129.470ab499.js"><link rel="prefetch" href="/assets/js/13.981bed03.js"><link rel="prefetch" href="/assets/js/130.635c8a4d.js"><link rel="prefetch" href="/assets/js/131.4d861aea.js"><link rel="prefetch" href="/assets/js/132.0caa953d.js"><link rel="prefetch" href="/assets/js/14.c26d023b.js"><link rel="prefetch" href="/assets/js/15.d5c2c93b.js"><link rel="prefetch" href="/assets/js/16.965c1f4b.js"><link rel="prefetch" href="/assets/js/17.43006289.js"><link rel="prefetch" href="/assets/js/18.ea4bd63d.js"><link rel="prefetch" href="/assets/js/19.f49cda6b.js"><link rel="prefetch" href="/assets/js/20.8aa89424.js"><link rel="prefetch" href="/assets/js/21.c3b20e59.js"><link rel="prefetch" href="/assets/js/22.bc9edfa5.js"><link rel="prefetch" href="/assets/js/23.1f95e41f.js"><link rel="prefetch" href="/assets/js/24.dc0d609a.js"><link rel="prefetch" href="/assets/js/25.a8eb84d8.js"><link rel="prefetch" href="/assets/js/26.8b5d5959.js"><link rel="prefetch" href="/assets/js/27.675f9419.js"><link rel="prefetch" href="/assets/js/28.c74386af.js"><link rel="prefetch" href="/assets/js/29.85872ea6.js"><link rel="prefetch" href="/assets/js/30.6a883795.js"><link rel="prefetch" href="/assets/js/31.dbc19d00.js"><link rel="prefetch" href="/assets/js/32.7d1ed195.js"><link rel="prefetch" href="/assets/js/33.ca7cc2e5.js"><link rel="prefetch" href="/assets/js/34.17ffe6cd.js"><link rel="prefetch" href="/assets/js/35.9172f2c4.js"><link rel="prefetch" href="/assets/js/36.225ed4c8.js"><link rel="prefetch" href="/assets/js/37.ba5a93c3.js"><link rel="prefetch" href="/assets/js/38.668c8b09.js"><link rel="prefetch" href="/assets/js/39.696efc19.js"><link rel="prefetch" href="/assets/js/40.2bb8181c.js"><link rel="prefetch" href="/assets/js/41.cd548f6d.js"><link rel="prefetch" href="/assets/js/42.d0edeefa.js"><link rel="prefetch" href="/assets/js/43.47e05865.js"><link rel="prefetch" href="/assets/js/44.1d892c7c.js"><link rel="prefetch" href="/assets/js/45.df060df5.js"><link rel="prefetch" href="/assets/js/46.08d8ed44.js"><link rel="prefetch" href="/assets/js/47.187f8c9a.js"><link rel="prefetch" href="/assets/js/48.33272b76.js"><link rel="prefetch" href="/assets/js/49.25834461.js"><link rel="prefetch" href="/assets/js/5.b89c5eff.js"><link rel="prefetch" href="/assets/js/50.8f892034.js"><link rel="prefetch" href="/assets/js/51.831609e2.js"><link rel="prefetch" href="/assets/js/52.e082d28e.js"><link rel="prefetch" href="/assets/js/53.d79586c6.js"><link rel="prefetch" href="/assets/js/54.2ece5a15.js"><link rel="prefetch" href="/assets/js/55.733ff554.js"><link rel="prefetch" href="/assets/js/56.b671ba6d.js"><link rel="prefetch" href="/assets/js/57.13952422.js"><link rel="prefetch" href="/assets/js/58.4294c555.js"><link rel="prefetch" href="/assets/js/59.eeaf7997.js"><link rel="prefetch" href="/assets/js/6.3e150692.js"><link rel="prefetch" href="/assets/js/60.961f8a08.js"><link rel="prefetch" href="/assets/js/61.92451b8e.js"><link rel="prefetch" href="/assets/js/62.061bc853.js"><link rel="prefetch" href="/assets/js/63.736a5536.js"><link rel="prefetch" href="/assets/js/64.65ae2ffc.js"><link rel="prefetch" href="/assets/js/65.fafd3f67.js"><link rel="prefetch" href="/assets/js/66.d081c7b1.js"><link rel="prefetch" href="/assets/js/67.ef110bc5.js"><link rel="prefetch" href="/assets/js/68.74478be4.js"><link rel="prefetch" href="/assets/js/69.575b9134.js"><link rel="prefetch" href="/assets/js/7.5eb77440.js"><link rel="prefetch" href="/assets/js/70.302c6e63.js"><link rel="prefetch" href="/assets/js/71.a70177df.js"><link rel="prefetch" href="/assets/js/72.0d73a784.js"><link rel="prefetch" href="/assets/js/73.bef338db.js"><link rel="prefetch" href="/assets/js/74.b2a09c1b.js"><link rel="prefetch" href="/assets/js/75.c5e4ef96.js"><link rel="prefetch" href="/assets/js/76.4732db31.js"><link rel="prefetch" href="/assets/js/77.5a7baee2.js"><link rel="prefetch" href="/assets/js/78.6f2fbf95.js"><link rel="prefetch" href="/assets/js/79.43672222.js"><link rel="prefetch" href="/assets/js/8.3c5591af.js"><link rel="prefetch" href="/assets/js/80.20d60e20.js"><link rel="prefetch" href="/assets/js/81.2ab7e3ec.js"><link rel="prefetch" href="/assets/js/82.80fae736.js"><link rel="prefetch" href="/assets/js/83.99e905ae.js"><link rel="prefetch" href="/assets/js/84.2ce2ada1.js"><link rel="prefetch" href="/assets/js/85.31e9e030.js"><link rel="prefetch" href="/assets/js/86.a5d90c7f.js"><link rel="prefetch" href="/assets/js/87.8762f862.js"><link rel="prefetch" href="/assets/js/88.279e3baa.js"><link rel="prefetch" href="/assets/js/89.dbc436a2.js"><link rel="prefetch" href="/assets/js/9.e6b7ce22.js"><link rel="prefetch" href="/assets/js/90.de6fbc6a.js"><link rel="prefetch" href="/assets/js/91.ae3a4dc5.js"><link rel="prefetch" href="/assets/js/92.c61fae0c.js"><link rel="prefetch" href="/assets/js/93.359d6d41.js"><link rel="prefetch" href="/assets/js/94.d05b25ce.js"><link rel="prefetch" href="/assets/js/95.11af6f15.js"><link rel="prefetch" href="/assets/js/96.7825aa06.js"><link rel="prefetch" href="/assets/js/97.a749d9fc.js"><link rel="prefetch" href="/assets/js/98.90600453.js"><link rel="prefetch" href="/assets/js/99.0cdc2005.js"><link rel="prefetch" href="/assets/js/vendors~flowchart.b584dfe5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5e2bd223.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-4698c43e><div data-v-4698c43e><div id="loader-wrapper" class="loading-wrapper" data-v-1c4f0192 data-v-4698c43e data-v-4698c43e><div class="loader-main" data-v-1c4f0192><div data-v-1c4f0192></div><div data-v-1c4f0192></div><div data-v-1c4f0192></div><div data-v-1c4f0192></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-6cbeab0a data-v-4698c43e data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a>腾哥的学习笔记</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>腾哥</span>
            
          <span data-v-6cbeab0a>2022 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-4698c43e><header class="navbar" data-v-4698c43e><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">腾哥的学习笔记</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont reco-eye"></i>
  本站指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/react/" class="nav-link"><i class="iconfont undefined"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/golang/" class="nav-link"><i class="iconfont undefined"></i>
  golang
</a></li><li class="dropdown-item"><!----> <a href="/categories/go web开发相关/" class="nav-link"><i class="iconfont undefined"></i>
  go web开发相关
</a></li><li class="dropdown-item"><!----> <a href="/categories/go语言介绍/" class="nav-link"><i class="iconfont undefined"></i>
  go语言介绍
</a></li><li class="dropdown-item"><!----> <a href="/categories/go语言基础/" class="nav-link"><i class="iconfont undefined"></i>
  go语言基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/golang标准库/" class="nav-link"><i class="iconfont undefined"></i>
  golang标准库
</a></li><li class="dropdown-item"><!----> <a href="/categories/go语言标准库/" class="nav-link"><i class="iconfont undefined"></i>
  go语言标准库
</a></li><li class="dropdown-item"><!----> <a href="/categories/go单元测试/" class="nav-link"><i class="iconfont undefined"></i>
  go单元测试
</a></li><li class="dropdown-item"><!----> <a href="/categories/go 常用组件和技巧/" class="nav-link"><i class="iconfont undefined"></i>
  go 常用组件和技巧
</a></li><li class="dropdown-item"><!----> <a href="/categories/go 微服务/" class="nav-link"><i class="iconfont undefined"></i>
  go 微服务
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库相关/" class="nav-link"><i class="iconfont undefined"></i>
  数据库相关
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java基础/" class="nav-link"><i class="iconfont undefined"></i>
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="iconfont undefined"></i>
  java
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-sticky"></i>
      JAVA
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/java/javase.html" class="nav-link"><i class="iconfont undefined"></i>
  JavaSE
</a></li><li class="dropdown-subitem"><a href="/java/java高级/javaee.html" class="nav-link"><i class="iconfont undefined"></i>
  JavaEE
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      GoLang
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/golang/summary.html" class="nav-link"><i class="iconfont reco-category"></i>
  大纲
</a></li><li class="dropdown-item"><!----> <a href="/golang/go语言介绍/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  介绍、搭建
</a></li><li class="dropdown-item"><!----> <a href="/golang/go语言基础/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  基础
</a></li><li class="dropdown-item"><!----> <a href="/golang/go语言常用标准库/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  标准库
</a></li><li class="dropdown-item"><!----> <a href="/golang/单元测试/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  单元测试
</a></li><li class="dropdown-item"><!----> <a href="/golang/数据库相关/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/golang/Web开发相关/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  Web开发
</a></li><li class="dropdown-item"><!----> <a href="/golang/微服务相关/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  微服务
</a></li><li class="dropdown-item"><!----> <a href="/golang/常用组件和技巧/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  常用组件
</a></li><li class="dropdown-item"><!----> <a href="/golang/GORM教程/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  GORM
</a></li><li class="dropdown-item"><!----> <a href="/golang/消息队列/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  消息队列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front_end/summary.html" class="nav-link"><i class="iconfont reco-category"></i>
  大纲
</a></li><li class="dropdown-item"><!----> <a href="/front_end/vue/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/front_end/react/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  react
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      技术分享
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>git</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/技术文章/java/javase.html" class="nav-link"><i class="iconfont undefined"></i>
  JavaSE
</a></li><li class="dropdown-subitem"><a href="/技术文章/java高级/javaee.html" class="nav-link"><i class="iconfont undefined"></i>
  JavaEE
</a></li></ul></li><li class="dropdown-item"><h4>docker</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/技术文章/golang/about_golang.html" class="nav-link"><i class="iconfont undefined"></i>
  Go语言基础
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <a href="https://github.com/wangwenteng/blog" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-贡献代码！"></i>
    贡献代码！
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-4698c43e></div> <aside class="sidebar" data-v-4698c43e><div class="personal-info-wrapper" data-v-6c8ffc9c><img src="/avatar.png" alt="author-avatar" class="personal-img" data-v-6c8ffc9c> <h3 class="name" data-v-6c8ffc9c>
    腾哥
  </h3> <div class="num" data-v-6c8ffc9c><div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>117</h3> <h6 data-v-6c8ffc9c>文章</h6></div> <div data-v-6c8ffc9c><h3 data-v-6c8ffc9c>13</h3> <h6 data-v-6c8ffc9c>标签</h6></div></div> <hr data-v-6c8ffc9c></div> <nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link"><i class="iconfont reco-eye"></i>
  本站指南
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/react/" class="nav-link"><i class="iconfont undefined"></i>
  react
</a></li><li class="dropdown-item"><!----> <a href="/categories/前端/" class="nav-link"><i class="iconfont undefined"></i>
  前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/categories/golang/" class="nav-link"><i class="iconfont undefined"></i>
  golang
</a></li><li class="dropdown-item"><!----> <a href="/categories/go web开发相关/" class="nav-link"><i class="iconfont undefined"></i>
  go web开发相关
</a></li><li class="dropdown-item"><!----> <a href="/categories/go语言介绍/" class="nav-link"><i class="iconfont undefined"></i>
  go语言介绍
</a></li><li class="dropdown-item"><!----> <a href="/categories/go语言基础/" class="nav-link"><i class="iconfont undefined"></i>
  go语言基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/golang标准库/" class="nav-link"><i class="iconfont undefined"></i>
  golang标准库
</a></li><li class="dropdown-item"><!----> <a href="/categories/go语言标准库/" class="nav-link"><i class="iconfont undefined"></i>
  go语言标准库
</a></li><li class="dropdown-item"><!----> <a href="/categories/go单元测试/" class="nav-link"><i class="iconfont undefined"></i>
  go单元测试
</a></li><li class="dropdown-item"><!----> <a href="/categories/go 常用组件和技巧/" class="nav-link"><i class="iconfont undefined"></i>
  go 常用组件和技巧
</a></li><li class="dropdown-item"><!----> <a href="/categories/go 微服务/" class="nav-link"><i class="iconfont undefined"></i>
  go 微服务
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库相关/" class="nav-link"><i class="iconfont undefined"></i>
  数据库相关
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java基础/" class="nav-link"><i class="iconfont undefined"></i>
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="iconfont undefined"></i>
  java
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-sticky"></i>
      JAVA
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>Java</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/java/java/javase.html" class="nav-link"><i class="iconfont undefined"></i>
  JavaSE
</a></li><li class="dropdown-subitem"><a href="/java/java高级/javaee.html" class="nav-link"><i class="iconfont undefined"></i>
  JavaEE
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      GoLang
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/golang/summary.html" class="nav-link"><i class="iconfont reco-category"></i>
  大纲
</a></li><li class="dropdown-item"><!----> <a href="/golang/go语言介绍/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  介绍、搭建
</a></li><li class="dropdown-item"><!----> <a href="/golang/go语言基础/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  基础
</a></li><li class="dropdown-item"><!----> <a href="/golang/go语言常用标准库/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  标准库
</a></li><li class="dropdown-item"><!----> <a href="/golang/单元测试/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  单元测试
</a></li><li class="dropdown-item"><!----> <a href="/golang/数据库相关/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/golang/Web开发相关/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  Web开发
</a></li><li class="dropdown-item"><!----> <a href="/golang/微服务相关/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  微服务
</a></li><li class="dropdown-item"><!----> <a href="/golang/常用组件和技巧/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  常用组件
</a></li><li class="dropdown-item"><!----> <a href="/golang/GORM教程/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  GORM
</a></li><li class="dropdown-item"><!----> <a href="/golang/消息队列/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  消息队列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      前端
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front_end/summary.html" class="nav-link"><i class="iconfont reco-category"></i>
  大纲
</a></li><li class="dropdown-item"><!----> <a href="/front_end/vue/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  vue
</a></li><li class="dropdown-item"><!----> <a href="/front_end/react/00summary.html" class="nav-link"><i class="iconfont reco-document"></i>
  react
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-api"></i>
      技术分享
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>git</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/技术文章/java/javase.html" class="nav-link"><i class="iconfont undefined"></i>
  JavaSE
</a></li><li class="dropdown-subitem"><a href="/技术文章/java高级/javaee.html" class="nav-link"><i class="iconfont undefined"></i>
  JavaEE
</a></li></ul></li><li class="dropdown-item"><h4>docker</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/技术文章/golang/about_golang.html" class="nav-link"><i class="iconfont undefined"></i>
  Go语言基础
</a></li></ul></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div> <a href="https://github.com/wangwenteng/blog" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-贡献代码！"></i>
    贡献代码！
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>微服务相关</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/golang/微服务相关/00summary.html" class="sidebar-link">Go Web 微服务</a></li><li><a href="/golang/微服务相关/01RPC.html" class="sidebar-link">RPC介绍</a></li><li><a href="/golang/微服务相关/02protobuf.html" class="sidebar-link">protocol buffers初识</a></li><li><a href="/golang/微服务相关/03protov.html" class="active sidebar-link">Protocol Buffers V3指南[翻译]</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/golang/微服务相关/03protov.html#any" class="sidebar-link">Any</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/golang/微服务相关/03protov.html#oneof" class="sidebar-link">oneof</a></li><li class="sidebar-sub-header"><a href="/golang/微服务相关/03protov.html#maps" class="sidebar-link">Maps</a></li></ul></li><li class="sidebar-sub-header"><a href="/golang/微服务相关/03protov.html#packages" class="sidebar-link">Packages</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/golang/微服务相关/03protov.html#定义服务" class="sidebar-link">定义服务</a></li></ul></li><li class="sidebar-sub-header"><a href="/golang/微服务相关/03protov.html#json-映射" class="sidebar-link">JSON 映射</a></li><li class="sidebar-sub-header"><a href="/golang/微服务相关/03protov.html#options" class="sidebar-link">Options</a></li></ul></li><li><a href="/golang/微服务相关/04grpc.html" class="sidebar-link">gRPC快速入门</a></li><li><a href="/golang/微服务相关/05consul.html" class="sidebar-link">基于consul实现服务注册与发现</a></li><li><a href="/golang/微服务相关/06apollo.html" class="sidebar-link">Apollo配置中心</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-6cbeab0a data-v-4698c43e><h3 class="title" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a>Protocol Buffers V3指南[翻译]</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><input type="password" value="" data-v-6cbeab0a> <span data-v-6cbeab0a>Konck! Knock!</span> <button data-v-6cbeab0a>OK</button></label> <div class="footer" style="display:none;" data-v-6cbeab0a data-v-6cbeab0a><span data-v-6cbeab0a><i class="iconfont reco-theme" data-v-6cbeab0a></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-6cbeab0a>vuePress-theme-reco</a></span> <span data-v-6cbeab0a><i class="iconfont reco-copyright" data-v-6cbeab0a></i> <a data-v-6cbeab0a><span data-v-6cbeab0a>腾哥</span>
            
          <span data-v-6cbeab0a>2022 - </span>
          2022
        </a></span></div></div> <div data-v-4698c43e><main class="page"><!----> <div class="page-title" style="display:none;"><h1>Protocol Buffers V3指南[翻译]</h1> <hr> <div data-v-484a899e><i class="iconfont reco-account" data-v-484a899e><span data-v-484a899e>腾哥</span></i> <i class="iconfont reco-date" data-v-484a899e><span data-v-484a899e>2022-06-22 14:06:35</span></i> <i class="iconfont reco-eye" data-v-484a899e><span id="/golang/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9B%B8%E5%85%B3/03protov.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-484a899e><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-484a899e><span class="tag-item" data-v-484a899e>
      golang
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><div class="custom-block danger"><p class="custom-block-title">说明</p> <p>本文是官方protocol buffers v3指南的翻译。</p> <p>本文翻译自https://developers.google.com/protocol-buffers/docs/proto3。</p></div> <h3 id="定义一个消息类型"><a href="#定义一个消息类型" class="header-anchor">#</a> 定义一个消息类型</h3> <p>首先让我们看一个非常简单的例子。假设您想要定义一个搜索请求消息格式，其中每个搜索请求都包含一个查询词字符串、你感兴趣的查询结果所在的特定页码数和每一页应展示的结果数。</p> <p>下面是用于定义这个消息类型的 <code>.proto</code> 文件。</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">syntax</span> <span class="token operator">=</span> <span class="token string">&quot;proto3&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">message</span> <span class="token class-name">SearchRequest</span> <span class="token punctuation">{</span>
  <span class="token builtin">string</span> query <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">int32</span> page_number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">int32</span> result_per_page <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>文件的第一行指定使用 <code>proto3</code> 语法: 如果不这样写，protocol buffer编译器将假定你使用 <code>proto2</code>。这个声明必须是文件的第一个非空非注释行。</li> <li><code>SearchRequest</code> 消息定义指定了三个字段(名称/值对) ，每个字段表示希望包含在此类消息中的每一段数据。每个字段都有一个名称和一个类型。</li></ul> <h4 id="指定字段类型"><a href="#指定字段类型" class="header-anchor">#</a> 指定字段类型</h4> <p>在上面的示例中，所有字段都是标量类型（scalar types）: 两个整数(<code>page_number</code>和 <code>result_per_page</code>)和一个字符串(<code>query</code>)。但是也可以为字段指定组合类型，包括枚举和其他消息类型。</p> <h4 id="分配字段编号"><a href="#分配字段编号" class="header-anchor">#</a> 分配字段编号</h4> <p>如你所见，消息定义中的每个字段都有一个<strong>唯一的编号</strong>。这些字段编号用来在消息二进制格式中标识字段，在消息类型使用后就不能再更改。注意，范围1到15中的字段编号需要一个字节进行编码，包括字段编号和字段类型。范围16到2047的字段编号采用两个字节。因此，应该为经常使用的消息元素保留数字1到15的编号。切记为将来可能添加的经常使用的元素留出一些编号。</p> <p>你可以指定的最小字段数是1，最大的字段数是 229−1229−1 ，即536,870,911。你也不能使用19000到19999 (<code>FieldDescriptor::kFirstReservedNumber</code> 到<code>FieldDescriptor::kLastReservedNumber</code>)的编号，它们是预留给Protocol Buffers协议实现的。如果你在你的<code>.proto</code>文件中使用了预留的编号Protocol Buffers编译器就会报错。同样，你也不能使用任何之前保留的字段编号。</p> <h4 id="指定字段规则"><a href="#指定字段规则" class="header-anchor">#</a> 指定字段规则</h4> <p>消息字段可以是下列字段之一:</p> <ul><li>singular: 格式良好的消息可以有这个字段的零个或一个(但不能多于一个)。这是 proto3语法的默认字段规则。</li> <li><code>repeated</code>: 该字段可以在格式良好的消息中重复任意次数(包括零次)。重复值的顺序将被保留。</li></ul> <p>在 proto3中，标量数值类型的<code>repeated</code>字段默认使用<code>packed</code>编码。</p> <p>你可以在 <a href="https://developers.google.com/protocol-buffers/docs/encoding#packed" target="_blank" rel="noopener noreferrer">Protocol Buffer Encoding<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 中找到关于<code>packed</code>编码的更多信息。</p> <h4 id="添加更多消息类型"><a href="#添加更多消息类型" class="header-anchor">#</a> 添加更多消息类型</h4> <p>可以在一个<code>.proto</code> 文件中定义多个消息类型。如果你正在定义多个相关的消息，这是非常有用的——例如，如果想定义与 <code>SearchRequest</code> 消息类型对应的应答消息格式<code>SearchResponse</code>，你就可以将其添加到同一个<code>.proto</code>文件中。</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">SearchRequest</span> <span class="token punctuation">{</span>
  <span class="token builtin">string</span> query <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">int32</span> page_number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">int32</span> result_per_page <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">message</span> <span class="token class-name">SearchResponse</span> <span class="token punctuation">{</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="添加注释"><a href="#添加注释" class="header-anchor">#</a> 添加注释</h4> <p>要给你的<code>.proto</code>文件添加注释，需要使用C/C++风格的<code>//</code>和<code>/* ... */</code>语法。</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token comment">/* SearchRequest represents a search query, with pagination options to
 * indicate which results to include in the response. */</span>

<span class="token keyword">message</span> <span class="token class-name">SearchRequest</span> <span class="token punctuation">{</span>
  <span class="token builtin">string</span> query <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">int32</span> page_number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>  <span class="token comment">// Which page number do we want?</span>
  <span class="token builtin">int32</span> result_per_page <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>  <span class="token comment">// Number of results to return per page.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="保留字段"><a href="#保留字段" class="header-anchor">#</a> 保留字段</h4> <p>如果你通过完全删除字段或将其注释掉来<strong>更新</strong>消息类型，那么未来的用户在对该类型进行自己的更新时可以重用字段号。如果其他人以后加载旧版本的相同<code>.proto</code>文件，这可能会导致严重的问题，包括数据损坏，隐私漏洞等等。确保这种情况不会发生的一种方法是指定已删除字段的字段编号(和/或名称，这也可能导致 JSON 序列化问题)是保留的（<code>reserved</code>）。如果将来有任何用户尝试使用这些字段标识符，protocol buffer编译器将发出提示。</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
  <span class="token keyword">reserved</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">9</span> <span class="token keyword">to</span> <span class="token number">11</span><span class="token punctuation">;</span>
  <span class="token keyword">reserved</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注意，不能在同一个<code>reserved</code>语句中混合字段名和字段编号。</p> <h4 id="从你的-proto文件生成了什么"><a href="#从你的-proto文件生成了什么" class="header-anchor">#</a> 从你的<code>.proto</code>文件生成了什么？</h4> <p>当你使用 protocol buffer 编译器来运行<code>.proto</code>文件时，编译器用你选择的语言生成你需要使用文件中描述的消息类型，包括获取和设置字段值，将消息序列化为输出流，以及从输入流解析消息的代码。</p> <ul><li>对**C++**来说，编译器会为每个<code>.proto</code>文件生成一个<code>.h</code>文件和一个<code>.cc</code>文件，<code>.proto</code>文件中的每一个消息有一个对应的类。</li> <li>对于 <strong>Java</strong>，编译器生成一个<code>.java</code> 文件，每种消息类型都有一个类，还有一个特殊的 <code>Builder</code> 类用于创建消息类实例。</li> <li>对于 <strong>Kotlin</strong>，除了 Java 生成的代码之外，编译器还生成一个每种消息类型的 <code>.kt</code> 文件，包含一个 DSL，可用于简化消息实例的创建。</li> <li><strong>Python</strong> 稍有不同ー Python 编译器为<code>.proto</code>文件中的每个消息类型生成一个带静态描述符的模块，然后与<em>metaclass</em>一起使用，在运行时创建必要的 Python 数据访问类。</li> <li>对于 <strong>Go</strong>，编译器为文件中的每种消息类型生成一个类型（type）到一个<code>.pb.go</code> 文件。</li> <li>对于 <strong>Ruby</strong>，编译器生成一个<code>.rb</code> 文件，其中包含一个包含消息类型的 Ruby 模块。</li> <li>对于 <strong>Objective-C</strong>，编译器从每个<code>.proto</code>文件生成一个 <code>pbobjc.h</code> 和 <code>pbobjc.m</code> 文件，<code>.proto</code>文件中描述的每种消息类型都有一个类。</li> <li>对于 <strong>C#</strong> ，编译器生从每个<code>.proto</code>文件生成一个<code>.cs</code> 文件。<code>.proto</code>文件中描述的每种消息类型都有一个类。</li> <li>对于 <strong>Dart</strong>，编译器为文件中的每种消息类型生成一个<code>.pb.dart</code> 文件。</li></ul> <p>你可以通过学习所选语言的教程(proto3版本即将推出)了解更多关于使用每种语言的 API 的信息。有关 API 的更多细节，请参阅相关的 <a href="https://developers.google.com/protocol-buffers/docs/reference/overview" target="_blank" rel="noopener noreferrer">API reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>(proto3版本也即将推出)。</p> <h3 id="标量值类型"><a href="#标量值类型" class="header-anchor">#</a> 标量值类型</h3> <p>标量消息字段可以具有以下类型之一——该表显示了<code>.proto</code>文件，以及自动生成类中的对应类型:</p> <table><thead><tr><th style="text-align:center;">.proto Type</th> <th style="text-align:center;">Notes</th> <th style="text-align:center;">C++ Type</th> <th style="text-align:center;">Java/Kotlin Type[1]</th> <th style="text-align:center;">Python Type[3]</th> <th style="text-align:center;">Go Type</th> <th style="text-align:center;">Ruby Type</th> <th style="text-align:center;">C# Type</th> <th style="text-align:center;">PHP Type</th> <th style="text-align:center;">Dart Type</th></tr></thead> <tbody><tr><td style="text-align:center;">double</td> <td style="text-align:center;"></td> <td style="text-align:center;">double</td> <td style="text-align:center;">double</td> <td style="text-align:center;">float</td> <td style="text-align:center;">float64</td> <td style="text-align:center;">Float</td> <td style="text-align:center;">double</td> <td style="text-align:center;">float</td> <td style="text-align:center;">double</td></tr> <tr><td style="text-align:center;">float</td> <td style="text-align:center;"></td> <td style="text-align:center;">float</td> <td style="text-align:center;">float</td> <td style="text-align:center;">float</td> <td style="text-align:center;">float32</td> <td style="text-align:center;">Float</td> <td style="text-align:center;">float</td> <td style="text-align:center;">float</td> <td style="text-align:center;">double</td></tr> <tr><td style="text-align:center;">int32</td> <td style="text-align:center;">Uses variable-length encoding. Inefficient for encoding negative numbers – if your field is likely to have negative values, use sint32 instead.</td> <td style="text-align:center;">int32</td> <td style="text-align:center;">int</td> <td style="text-align:center;">int</td> <td style="text-align:center;">int32</td> <td style="text-align:center;">Fixnum or Bignum (as required)</td> <td style="text-align:center;">int</td> <td style="text-align:center;">integer</td> <td style="text-align:center;">int</td></tr> <tr><td style="text-align:center;">int64</td> <td style="text-align:center;">Uses variable-length encoding. Inefficient for encoding negative numbers – if your field is likely to have negative values, use sint64 instead.</td> <td style="text-align:center;">int64</td> <td style="text-align:center;">long</td> <td style="text-align:center;">int/long[4]</td> <td style="text-align:center;">int64</td> <td style="text-align:center;">Bignum</td> <td style="text-align:center;">long</td> <td style="text-align:center;">integer/string[6]</td> <td style="text-align:center;">Int64</td></tr> <tr><td style="text-align:center;">uint32</td> <td style="text-align:center;">Uses variable-length encoding.</td> <td style="text-align:center;">uint32</td> <td style="text-align:center;">int[2]</td> <td style="text-align:center;">int/long[4]</td> <td style="text-align:center;">uint32</td> <td style="text-align:center;">Fixnum or Bignum (as required)</td> <td style="text-align:center;">uint</td> <td style="text-align:center;">integer</td> <td style="text-align:center;">int</td></tr> <tr><td style="text-align:center;">uint64</td> <td style="text-align:center;">Uses variable-length encoding.</td> <td style="text-align:center;">uint64</td> <td style="text-align:center;">long[2]</td> <td style="text-align:center;">int/long[4]</td> <td style="text-align:center;">uint64</td> <td style="text-align:center;">Bignum</td> <td style="text-align:center;">ulong</td> <td style="text-align:center;">integer/string[6]</td> <td style="text-align:center;">Int64</td></tr> <tr><td style="text-align:center;">sint32</td> <td style="text-align:center;">Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int32s.</td> <td style="text-align:center;">int32</td> <td style="text-align:center;">int</td> <td style="text-align:center;">int</td> <td style="text-align:center;">int32</td> <td style="text-align:center;">Fixnum or Bignum (as required)</td> <td style="text-align:center;">int</td> <td style="text-align:center;">integer</td> <td style="text-align:center;">int</td></tr> <tr><td style="text-align:center;">sint64</td> <td style="text-align:center;">Uses variable-length encoding. Signed int value. These more efficiently encode negative numbers than regular int64s.</td> <td style="text-align:center;">int64</td> <td style="text-align:center;">long</td> <td style="text-align:center;">int/long[4]</td> <td style="text-align:center;">int64</td> <td style="text-align:center;">Bignum</td> <td style="text-align:center;">long</td> <td style="text-align:center;">integer/string[6]</td> <td style="text-align:center;">Int64</td></tr> <tr><td style="text-align:center;">fixed32</td> <td style="text-align:center;">Always four bytes. More efficient than uint32 if values are often greater than 228.</td> <td style="text-align:center;">uint32</td> <td style="text-align:center;">int[2]</td> <td style="text-align:center;">int/long[4]</td> <td style="text-align:center;">uint32</td> <td style="text-align:center;">Fixnum or Bignum (as required)</td> <td style="text-align:center;">uint</td> <td style="text-align:center;">integer</td> <td style="text-align:center;">int</td></tr> <tr><td style="text-align:center;">fixed64</td> <td style="text-align:center;">Always eight bytes. More efficient than uint64 if values are often greater than 256.</td> <td style="text-align:center;">uint64</td> <td style="text-align:center;">long[2]</td> <td style="text-align:center;">int/long[4]</td> <td style="text-align:center;">uint64</td> <td style="text-align:center;">Bignum</td> <td style="text-align:center;">ulong</td> <td style="text-align:center;">integer/string[6]</td> <td style="text-align:center;">Int64</td></tr> <tr><td style="text-align:center;">sfixed32</td> <td style="text-align:center;">Always four bytes.</td> <td style="text-align:center;">int32</td> <td style="text-align:center;">int</td> <td style="text-align:center;">int</td> <td style="text-align:center;">int32</td> <td style="text-align:center;">Fixnum or Bignum (as required)</td> <td style="text-align:center;">int</td> <td style="text-align:center;">integer</td> <td style="text-align:center;">int</td></tr> <tr><td style="text-align:center;">sfixed64</td> <td style="text-align:center;">Always eight bytes.</td> <td style="text-align:center;">int64</td> <td style="text-align:center;">long</td> <td style="text-align:center;">int/long[4]</td> <td style="text-align:center;">int64</td> <td style="text-align:center;">Bignum</td> <td style="text-align:center;">long</td> <td style="text-align:center;">integer/string[6]</td> <td style="text-align:center;">Int64</td></tr> <tr><td style="text-align:center;">bool</td> <td style="text-align:center;"></td> <td style="text-align:center;">bool</td> <td style="text-align:center;">boolean</td> <td style="text-align:center;">bool</td> <td style="text-align:center;">bool</td> <td style="text-align:center;">TrueClass/FalseClass</td> <td style="text-align:center;">bool</td> <td style="text-align:center;">boolean</td> <td style="text-align:center;">bool</td></tr> <tr><td style="text-align:center;">string</td> <td style="text-align:center;">A string must always contain UTF-8 encoded or 7-bit ASCII text, and cannot be longer than 232.</td> <td style="text-align:center;">string</td> <td style="text-align:center;">String</td> <td style="text-align:center;">str/unicode[5]</td> <td style="text-align:center;">string</td> <td style="text-align:center;">String (UTF-8)</td> <td style="text-align:center;">string</td> <td style="text-align:center;">string</td> <td style="text-align:center;">String</td></tr> <tr><td style="text-align:center;">bytes</td> <td style="text-align:center;">May contain any arbitrary sequence of bytes no longer than 232.</td> <td style="text-align:center;">string</td> <td style="text-align:center;">ByteString</td> <td style="text-align:center;">str (Python 2) bytes (Python 3)</td> <td style="text-align:center;">[]byte</td> <td style="text-align:center;">String (ASCII-8BIT)</td> <td style="text-align:center;">ByteString</td> <td style="text-align:center;">string</td> <td style="text-align:center;">List</td></tr></tbody></table> <p>在使用 <a href="https://developers.google.com/protocol-buffers/docs/encoding" target="_blank" rel="noopener noreferrer">Protocol Buffer Encoding<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 对消息进行序列化时，可以了解有关这些类型如何编码的更多信息。</p> <p>[1] Kotlin 使用来自 Java 的相应类型，甚至是无符号类型，以确保混合 Java/Kotlin 代码库的兼容性。</p> <p>[2] 在 Java 中，无符号的32位和64位整数使用它们的有符号对应项来表示，最高位存储在有符号位中。</p> <p>[3] 在任何情况下，为字段设置值都将执行类型检查，以确保其有效。</p> <p>[4] 64位或无符号的32位整数在解码时总是表示为 long ，但如果在设置字段时给出 int，则可以表示为 int。在任何情况下，值必须与设置时表示的类型相匹配。见[2]。</p> <p>[5] Python 字符串在解码时表示为 unicode，但如果给出了 ASCII 字符串，则可以表示为 str (这可能会更改)。</p> <p>[6] 整数用于64位机器，字符串用于32位机器。</p> <h3 id="默认值"><a href="#默认值" class="header-anchor">#</a> 默认值</h3> <p>当解析消息时，如果编码消息不包含特定的 singular 元素，则解析对象中的相应字段将设置为该字段的默认值。</p> <ul><li>对于字符串，默认值为空字符串。</li> <li>对于字节，默认值为空字节。</li> <li>对于布尔值，默认值为 false。</li> <li>对于数值类型，默认值为零。</li> <li>对于枚举，默认值是第一个定义的枚举值，该值必须为0。</li> <li>对于消息字段，未设置该字段。其确切值与语言有关。详细信息请参阅<a href="https://developers.google.com/protocol-buffers/docs/reference/overview" target="_blank" rel="noopener noreferrer">生成的代码指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li></ul> <p>repeated 字段的默认值为空(通常是适当语言中的空列表)。</p> <p>请注意，对于标量消息字段，一旦消息被解析，就无法判断字段是显式设置为默认值(例如，是否一个布尔值是被设置为 <code>false</code>)还是根本没有设置: 在定义消息类型时应该牢记这一点。例如，如果您不希望某个行为在默认情况下也发生，那么就不要设置一个布尔值，该布尔值在设置为 <code>false</code> 时会开启某些行为。还要注意，如果将标量消息字段<strong>设置</strong>为默认值，则该值将不会在传输过程中序列化。</p> <p>有关生成的代码的默认工作方式的更多详细信息，请参阅所选语言的<a href="https://developers.google.com/protocol-buffers/docs/reference/overview" target="_blank" rel="noopener noreferrer">生成代码指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h3 id="枚举"><a href="#枚举" class="header-anchor">#</a> 枚举</h3> <p>在定义消息类型时，你可能希望其中一个字段只能是预定义的值列表中的一个值。例如，假设你想为每个 <code>SearchRequest</code> 添加一个语料库字段，其中语料库可以是 <code>UNIVERSAL</code>、 <code>WEB</code>、 <code>IMAGES</code>、 <code>LOCAL</code>、 <code>NEWS</code>、 <code>PRODUCTS</code> 或 <code>VIDEO</code>。你可以通过在消息定义中添加一个枚举，为每个可能的值添加一个常量来非常简单地完成这项工作。</p> <p>在下面的例子中，我们添加了一个名为 <code>Corpus</code> 的<code>enum</code>，包含所有可能的值，以及一个类型为 <code>Corpus</code> 的字段:</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">SearchRequest</span> <span class="token punctuation">{</span>
  <span class="token builtin">string</span> query <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">int32</span> page_number <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">int32</span> result_per_page <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token keyword">enum</span> <span class="token class-name">Corpus</span> <span class="token punctuation">{</span>
    UNIVERSAL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    WEB <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    IMAGES <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    LOCAL <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    NEWS <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    PRODUCTS <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    VIDEO <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token positional-class-name class-name">Corpus</span> corpus <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>如你所见，Corpus enum 的第一个常量映射为零: 每个 enum 定义必须包含一个常量，该常量映射为零作为它的第一个元素。这是因为:</p> <ol><li>必须有一个零值，这样我们就可以使用0作为数值默认值。</li> <li>零值必须是第一个元素，以便与 proto2语义兼容，其中第一个枚举值总是默认值。</li></ol> <p>你可以通过将相同的值分配给不同的枚举常量来定义别名。为此，你需要将 <code>allow _ alias</code> 选项设置为 <code>true</code>，否则，当发现别名时，protocol 编译器将生成错误消息。</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">MyMessage1</span> <span class="token punctuation">{</span>
  <span class="token keyword">enum</span> <span class="token class-name">EnumAllowingAlias</span> <span class="token punctuation">{</span>
    <span class="token keyword">option</span> allow_alias <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    UNKNOWN <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    STARTED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    RUNNING <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">message</span> <span class="token class-name">MyMessage2</span> <span class="token punctuation">{</span>
  <span class="token keyword">enum</span> <span class="token class-name">EnumNotAllowingAlias</span> <span class="token punctuation">{</span>
    UNKNOWN <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    STARTED <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token comment">// RUNNING = 1;  // Uncommenting this line will cause a compile error inside Google and a warning message outside.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>枚举的常数必须在32位整数的范围内。由于枚举值在传输时使用<a href="https://developers.google.com/protocol-buffers/docs/encoding" target="_blank" rel="noopener noreferrer">变长编码<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，因此负值效率低，因此不推荐使用。可以在消息定义中定义枚举，如上面的例子所示，也可以在外面定义——这样就可以在<code>.proto</code>文件中的消息定义中重用这些枚举。你还可以使用<code>_MessageType_._EnumType_</code> 语法，使用在一个消息中声明的<code>enum</code>类型作为不同消息中的字段类型。</p> <p>当对一个使用了枚举的<code>.proto</code>文件运行 protocol buffer 编译器的时候，对于 Java, Kotlin,或 C++ 生成的代码中将有一个对应的enum，或者对于 Python 会生成一个特殊的<code>EnumDescriptor</code>类，它被用于在运行时生成的类中创建一组带有整数值的符号常量。</p> <p>**注意：**生成的代码可能会受到特定于语言的枚举数限制(单种语言的数量低于千)。请检查你计划使用的语言的限制。</p> <p>在反序列化过程中，不可识别的枚举值将保留在消息中，尽管当消息被反序列化时，这种值的表示方式依赖于语言。在支持值超出指定符号范围(如 C++ 和 Go)的开放枚举类型的语言中，未知枚举值仅存储为其底层的整数表示形式。在具有闭合枚举类型(如 Java)的语言中，枚举中的一个类型将用于表示一个无法识别的值，并且可以使用特殊的访问器访问底层的整数。在这两种情况下，如果消息被序列化，那么不可识别的值仍然会与消息一起被序列化。</p> <p>有关如何在应用程序中使用消息<code>enum</code>的详细信息，请参阅为所选语言<a href="https://developers.google.com/protocol-buffers/docs/reference/overview" target="_blank" rel="noopener noreferrer">生成的代码指南<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="预留值"><a href="#预留值" class="header-anchor">#</a> 预留值</h4> <p>如果通过完全删除枚举条目或注释掉枚举类型来更新枚举类型，那么未来的用户在自己更新该类型时可以重用该数值。这可能会导致严重的问题，如果以后有人加载旧版本的相同<code>.proto</code>文件，包括数据损坏，隐私漏洞等等。确保不发生这种情况的一种方法是指定已删除条目的数值(和/或名称，这也可能导致 JSON 序列化问题)为 <code>reserved</code>。如果任何未来的用户试图使用这些标识符，protocol buffer 编译器将报错。你可以使用 <code>max</code>关键字指定保留的数值范围最大为可能的值。</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">enum</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
  <span class="token keyword">reserved</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">9</span> <span class="token keyword">to</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">40</span> <span class="token keyword">to</span> max<span class="token punctuation">;</span>
  <span class="token keyword">reserved</span> <span class="token string">&quot;FOO&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;BAR&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>注意，不能在同一个保留语句中混合字段名和数值。</p> <h3 id="使用其他消息类型"><a href="#使用其他消息类型" class="header-anchor">#</a> 使用其他消息类型</h3> <p>你可以使用其他消息类型作为字段类型。例如，假设你希望在每个 <code>SearchResponse</code>消息中包含UI个 <code>Result</code>消息——为了做到这一点，你可以在同一个<code>.proto</code>文件中定义 <code>Result</code>消息类型。然后在 <code>SearchResponse</code>中指定 <code>Result</code> 类型的字段。</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">SearchResponse</span> <span class="token punctuation">{</span>
  <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">Result</span> results <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">message</span> <span class="token class-name">Result</span> <span class="token punctuation">{</span>
  <span class="token builtin">string</span> url <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">string</span> title <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">repeated</span> <span class="token builtin">string</span> snippets <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h4 id="导入定义"><a href="#导入定义" class="header-anchor">#</a> 导入定义</h4> <p>在上面的示例中，<code>Result</code>消息类型定义在与 <code>SearchResponse</code>相同的文件中——如果你希望用作字段类型的消息类型已经在另一个<code>.proto</code>文件中定义了，该怎么办？</p> <p>你可以通过 <em>import</em> 来使用来自其他 <code>.proto</code> 文件的定义。要导入另一个<code>.proto</code> 的定义，你需要在文件顶部添加一个 import 语句:</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">import</span> <span class="token string">&quot;myproject/other_protos.proto&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>默认情况下，只能从直接导入的 <code>.proto</code> 文件中使用定义。但是，有时你可能需要将 <code>.proto</code> 文件移动到新的位置。你可以在旧目录放一个占位的<code>.proto</code>文件使用<code>import public</code> 概念将所有导入转发到新位置，而不必直接移动<code>.proto</code>文件并修改所有的地方。</p> <p><strong>注意，Java 中没有 import public 功能。</strong></p> <p><code>import public</code>依赖项可以被任何导入包含<code>import public</code>语句的 proto 的代码传递依赖。例如：</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token comment">// new.proto</span>
<span class="token comment">// All definitions are moved here</span>
<span class="token comment">// old.proto</span>
<span class="token comment">// This is the proto that all clients are importing.</span>
<span class="token keyword">import</span> <span class="token keyword">public</span> <span class="token string">&quot;new.proto&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;other.proto&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// client.proto</span>
<span class="token keyword">import</span> <span class="token string">&quot;old.proto&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// You use definitions from old.proto and new.proto, but not other.proto</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>protocol 编译器使用命令行<code>-I</code>/<code>--proto_path</code>参数指定的一组目录中搜索导入的文件。如果没有给该命令行参数，则查看调用编译器的目录。一般来说，你应该将 <code>--proto_path</code> 参数设置为项目的根目录并为所有导入使用正确的名称。</p> <h4 id="使用proto2消息类型"><a href="#使用proto2消息类型" class="header-anchor">#</a> 使用proto2消息类型</h4> <p>导入 proto2消息类型并在 proto3消息中使用它们是可能的，反之亦然。然而，proto2 enum 不能直接在 proto3语法中使用(如果一个导入的 proto2消息使用了它们，那没问题)。</p> <h3 id="嵌套类型"><a href="#嵌套类型" class="header-anchor">#</a> 嵌套类型</h3> <p>你可以在其他消息类型中定义和使用消息类型，如下面的例子——这里的<code>Result</code>消息是在 <code>SearchResponse</code>消息中定义的:</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">SearchResponse</span> <span class="token punctuation">{</span>
  <span class="token keyword">message</span> <span class="token class-name">Result</span> <span class="token punctuation">{</span>
    <span class="token builtin">string</span> url <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token builtin">string</span> title <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">repeated</span> <span class="token builtin">string</span> snippets <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">Result</span> results <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>如果要在其父消息类型之外重用此消息类型，请通过<code>_Parent_._Type_</code>使用:</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">SomeOtherMessage</span> <span class="token punctuation">{</span>
  <span class="token positional-class-name class-name">SearchResponse<span class="token punctuation">.</span>Result</span> result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>你可以随心所欲地将信息一层又一层嵌入其中:</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">Outer</span> <span class="token punctuation">{</span>                  <span class="token comment">// Level 0</span>
  <span class="token keyword">message</span> <span class="token class-name">MiddleAA</span> <span class="token punctuation">{</span>  <span class="token comment">// Level 1</span>
    <span class="token keyword">message</span> <span class="token class-name">Inner</span> <span class="token punctuation">{</span>   <span class="token comment">// Level 2</span>
      <span class="token builtin">int64</span> ival <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token builtin">bool</span>  booly <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">message</span> <span class="token class-name">MiddleBB</span> <span class="token punctuation">{</span>  <span class="token comment">// Level 1</span>
    <span class="token keyword">message</span> <span class="token class-name">Inner</span> <span class="token punctuation">{</span>   <span class="token comment">// Level 2</span>
      <span class="token builtin">int32</span> ival <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token builtin">bool</span>  booly <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="更新消息类型"><a href="#更新消息类型" class="header-anchor">#</a> 更新消息类型</h3> <p>如果现有的消息类型不再满足你的所有需要——例如，你希望消息格式有一个额外的字段——但是你仍然希望使用用旧格式创建的代码，不要担心！在不破坏任何现有代码的情况下更新消息类型非常简单，只需记住以下规则:</p> <ul><li>不要更改任何现有字段的字段编号</li> <li>如果添加新字段，那么任何使用“旧”消息格式通过代码序列化的消息仍然可以通过新生成的代码进行解析。你应该记住这些元素的默认值，以便新代码能够正确地与旧代码生成的消息交互。类似地，新代码创建的消息可以通过旧代码解析: 旧的二进制文件在解析时直接忽略新字段。有关详细信息，请参阅 未知字段 部分。</li> <li>字段可以被删除，只要字段编号不再用于你更新的消息类型。你可能希望改为重命名字段，或者为其添加”OBSOLETE_“前缀，或者声明字段编号为<code>reserved</code>，以便<code>.proto</code>的未来用户不可能不小心重复使用这个编号。</li> <li><code>int32</code>、 <code>uint32</code>、 <code>int64</code>、 <code>uint64</code>和 <code>bool</code>都是兼容的——这意味着您可以在不破坏向前或向后兼容性的情况下将一个字段从这些类型中的一个更改为另一个。</li> <li>如果一个数字被解析到一个并不适当的类型中，你会得到与在 C++ 中将数字转换为该类型相同的效果(例如，如果一个64位的数字被读作 int32，它将被截断为32位)</li> <li><code>sint32</code>和 <code>sint64</code>相互兼容，但与其他整数类型不兼容。</li> <li><code>string</code>和<code>bytes</code>是兼容的，只要字节是有效的 UTF-8。</li> <li>如果字节包含消息的编码版本，则嵌入的消息与<code>bytes</code>兼容。</li> <li><code>fixed32</code>与 <code>sfixed32</code>兼容 <code>fixed64</code>与 <code>sfixed64</code>兼容。</li> <li>对于<code>string</code>、<code>bytes</code>和消息字段，<code>optional</code>字段与<code>repeated</code>字段兼容。给定重复字段的序列化数据作为输入，如果该字段是基本类型字段，期望该字段为可选字段的客户端将接受最后一个输入值; 如果该字段是消息类型字段，则合并所有输入元素。注意，这对于数字类型(包括 bools 和 enums)通常是不安全的。重复的数值类型字段可以按<code>packed</code>的格式序列化，如果是<code>optional</code>字段，则无法正确解析这些字段。</li> <li>Enum 在格式方面与 int32、 uint32、 int64和 uint64兼容(请注意，如果不适合，值将被截断)。但是要注意，当消息被反序列化时，客户端代码可能会区别对待它们: 例如，未被识别的 proto3 <code>enum</code>类型将保留在消息中，但是当消息被反序列化时，这种类型的表示方式依赖于语言。Int 字段总是保留它们的值。</li> <li>将单个值更改为<strong>新</strong>的<code>oneof</code>成员是安全的，并且二进制兼容。如果确保没有代码一次设置多个字段，那么将多个字段移动到新的<code>oneof</code>字段中可能是安全的。将任何字段移动到现有的字段中都是不安全的。</li></ul> <h3 id="未知字段"><a href="#未知字段" class="header-anchor">#</a> 未知字段</h3> <p>未知字段是格式良好的协议缓冲区序列化数据，表示解析器不识别的字段。例如，当旧二进制解析由新二进制发送的带有新字段的数据时，这些新字段将成为旧二进制中的未知字段。</p> <p>最初，proto3消息在解析过程中总是丢弃未知字段，但在3.5版本中，我们重新引入了未知字段的保存来匹配 proto2行为。在3.5及以后的版本中，解析期间保留未知字段，并将其包含在序列化输出中。</p> <h2 id="any"><a href="#any" class="header-anchor">#</a> Any</h2> <p><code>Any</code> 消息类型允许你将消息作为嵌入类型使用，而不需要其 <code>.proto</code> 定义。<code>Any</code>包含一个任意序列化的字节消息，以及一个解析为该消息的类型作为消息的全局唯一标识符的URL。要使用 <code>Any</code>类型，需要导入<code>google/protobuf/any.proto</code>。</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">import</span> <span class="token string">&quot;google/protobuf/any.proto&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">message</span> <span class="token class-name">ErrorStatus</span> <span class="token punctuation">{</span>
  <span class="token builtin">string</span> message <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">google<span class="token punctuation">.</span>protobuf<span class="token punctuation">.</span>Any</span> details <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>给定消息类型的默认类型 URL 是<code>type.googleapis.com/_packagename_._messagename_</code>。</p> <p>不同的语言实现将支持运行库助手以类型安全的方式打包和解包 <code>Any</code>值。例如在java中，Any类型会有特殊的<code>pack()</code>和<code>unpack()</code>访问器，在C++中会有<code>PackFrom()</code>和<code>UnpackTo()</code>方法。</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token comment">// Storing an arbitrary message type in Any.</span>
<span class="token positional-class-name class-name">NetworkErrorDetails</span> details <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token positional-class-name class-name">ErrorStatus</span> status<span class="token punctuation">;</span>
status<span class="token punctuation">.</span><span class="token function">add_details</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">PackFrom</span><span class="token punctuation">(</span>details<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Reading an arbitrary message from Any.</span>
<span class="token positional-class-name class-name">ErrorStatus</span> status <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token function">for</span> <span class="token punctuation">(</span>const Any<span class="token operator">&amp;</span> detail <span class="token punctuation">:</span> status<span class="token punctuation">.</span><span class="token function">details</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">if</span> <span class="token punctuation">(</span>detail<span class="token punctuation">.</span>Is<span class="token operator">&lt;</span>NetworkErrorDetails<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token positional-class-name class-name">NetworkErrorDetails</span> network_error<span class="token punctuation">;</span>
    detail<span class="token punctuation">.</span><span class="token function">UnpackTo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>network_error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> processing network_error <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><strong>目前正在开发用于处理任何类型的运行时库。</strong></p> <p>如果你已经熟悉 proto2语法，Any 可以保存任意的 proto3消息，类似于 proto2消息，可以允许扩展。</p> <h3 id="oneof"><a href="#oneof" class="header-anchor">#</a> oneof</h3> <p>如果你有一条包含许多字段的消息，并且最多同时设置一个字段，那么你可以通过使用其中一个特性来强制执行此行为并节省内存。</p> <p><code>oneof</code>字段类似于常规字段，只不过共享内存中的一个字段中的所有字段都是常规字段，而且最多可以同时设置一个字段。设置其中的任何成员都会自动清除所有其他成员。根据所选择的语言，可以使用特殊 <code>case()</code>或 <code>WhichOneof()</code> 方法检查 one of 中的哪个值被设置(如果有的话)。</p> <h4 id="使用oneof"><a href="#使用oneof" class="header-anchor">#</a> 使用oneof</h4> <p>要定义 oneof 字段需要在你的<code>.proto</code>文件中使用<code>oneof</code>关键字并在后面跟上名称，在下面的例子中字段名称为<code>test_oneof</code>。</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">SampleMessage</span> <span class="token punctuation">{</span>
  <span class="token keyword">oneof</span> test_oneof <span class="token punctuation">{</span>
    <span class="token builtin">string</span> name <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token positional-class-name class-name">SubMessage</span> sub_message <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>然后将其中一个字段添加到该字段的定义中。你可以添加任何类型的字段，除了<code>map</code>字段和<code>repeated</code>字段。</p> <p>在生成的代码中，其中一个字段具有与常规字段相同的 getter 和 setter。你还可以获得一个特殊的方法来检查其中一个设置了哪个值(如果有的话)。你可以在相关的 <a href="https://developers.google.com/protocol-buffers/docs/reference/overview" target="_blank" rel="noopener noreferrer">API 参考文献<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中找到更多关于所选语言的 API。</p> <h4 id="oneof-特性"><a href="#oneof-特性" class="header-anchor">#</a> oneof 特性</h4> <ul><li>设置一个字段将自动清除该字段的所有其他成员。因此，如果你设置了多个 oneof字段，那么只有最后设置的字段仍然具有值。</li></ul> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code>  SampleMessage <span class="token keyword">message</span><span class="token punctuation">;</span>
  <span class="token keyword">message</span><span class="token punctuation">.</span><span class="token function">set_name</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">CHECK</span><span class="token punctuation">(</span><span class="token keyword">message</span><span class="token punctuation">.</span><span class="token function">has_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">message</span><span class="token punctuation">.</span><span class="token function">mutable_sub_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// Will clear name field.</span>
  <span class="token function">CHECK</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">message</span><span class="token punctuation">.</span><span class="token function">has_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>如果解析器在连接中遇到同一个成员的多个成员，则只有最后看到的成员用于解析消息。</li> <li>oneof 不支持<code>repeated</code>。</li> <li>反射 api 适用于 oneof 字段。</li> <li>如果将 oneof 字段设置为默认值(例如将 int32 oneof 字段设置为0) ，则将设置该字段的“ case”，并在连接上序列化该值。</li> <li>如果你使用 C++ ，确保你的代码不会导致内存崩溃。下面的示例代码将崩溃，因为通过调用 <code>set_name()</code>方法已经删除了 <code>sub_message</code>。</li></ul> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code>  SampleMessage <span class="token keyword">message</span><span class="token punctuation">;</span>
  SubMessage<span class="token operator">*</span> sub_message <span class="token operator">=</span> <span class="token keyword">message</span><span class="token punctuation">.</span><span class="token function">mutable_sub_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">message</span><span class="token punctuation">.</span><span class="token function">set_name</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// Will delete sub_message</span>
  sub_message<span class="token operator">-</span><span class="token operator">&gt;</span>set_<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>            <span class="token comment">// Crashes here</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li>在C++中，如果你使用<code>Swap()</code>两个 oneof 消息，每个消息，两个消息将拥有对方的值，例如在下面的例子中，<code>msg1</code>会拥有<code>sub_message</code>并且<code>msg2</code>会有<code>name</code>。</li></ul> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code>  <span class="token positional-class-name class-name">SampleMessage</span> msg1<span class="token punctuation">;</span>
  msg1<span class="token punctuation">.</span><span class="token function">set_name</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token positional-class-name class-name">SampleMessage</span> msg2<span class="token punctuation">;</span>
  msg2<span class="token punctuation">.</span><span class="token function">mutable_sub_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  msg1<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>msg2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">CHECK</span><span class="token punctuation">(</span>msg1<span class="token punctuation">.</span><span class="token function">has_sub_message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">CHECK</span><span class="token punctuation">(</span>msg2<span class="token punctuation">.</span><span class="token function">has_name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="向后兼容性问题"><a href="#向后兼容性问题" class="header-anchor">#</a> 向后兼容性问题</h4> <p>添加或删除一个字段时要小心。如果检查 one of 的值返回<code>None</code>/<code>NOT_SET</code>，这可能意味着 one of 没有被设置，或者它已经被设置为 one of 的不同版本中的一个字段。这没有办法区分，因为没有办法知道未知字段是否是 oneof 的成员。</p> <p>标签重用问题</p> <ul><li>将字段移入或移出 oneof：在序列化和解析消息之后，你可能会丢失一些信息(某些字段将被清除)。但是，你可以安全地将单个字段移动到新的 oneof 字段中，并且如果已知只设置了一个字段，则可以移动多个字段。</li> <li>删除一个oneof 字段再添加回来：这可能会在消息被序列化和解析后清除当前设置的 oneof 字段。</li> <li>拆分或合并oneof：这与移动常规字段有类似的问题。</li></ul> <h3 id="maps"><a href="#maps" class="header-anchor">#</a> Maps</h3> <p>如果你想创建一个关联映射作为你数据定义的一部分，protocol buffers提供了一个方便的快捷语法:</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token map class-name">map<span class="token punctuation">&lt;</span>key_type<span class="token punctuation">,</span> value_type<span class="token punctuation">&gt;</span></span> map_field <span class="token operator">=</span> N<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>…其中<code>key_type</code>可以是任何整型或字符串类型(因此，除了浮点类型和字节以外的任何标量类型) 。注意，枚举不是有效的<code>key_type</code>。<code>value_type</code>可以是除另一个映射以外的任何类型。</p> <p>例如，如果你想创建一个项目映射，其中每个<code>Project</code>消息都与一个字符串键相关联，你可以这样定义:</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token map class-name">map<span class="token punctuation">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> Project<span class="token punctuation">&gt;</span></span> projects <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>映射字段不能重复。</li> <li>映射值的有线格式排序和映射迭代排序是未定义的，因此不能依赖于映射项的特定排序。</li> <li>当为 <code>.proto</code> 生成文本格式时，映射按键排序。数字键按数字排序。</li> <li>当从连接解析或合并时，如果有重复的映射键，则使用最后看到的键。当从文本格式解析映射时，如果有重复的键，解析可能会失败。</li> <li>如果为映射字段提供了键但没有值，则该字段序列化时的行为与语言相关。在 C++ 、 Java、 Kotlin 和 Python 中，类型的默认值是序列化的，而在其他语言中，没有任何值是序列化的。</li></ul> <p>生成的映射 API 目前可用于所有支持 proto3的语言。您可以在相关的 <a href="https://developers.google.com/protocol-buffers/docs/reference/overview" target="_blank" rel="noopener noreferrer">API 参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中找到更多关于所选语言的映射 API 的信息。</p> <h4 id="向后兼容性"><a href="#向后兼容性" class="header-anchor">#</a> 向后兼容性</h4> <p>map语法序列化后等同于如下内容，因此即使是不支持map语法的protocol buffer实现也是可以处理你的数据的：</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">MapFieldEntry</span> <span class="token punctuation">{</span>
  <span class="token positional-class-name class-name">key_type</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token positional-class-name class-name">value_type</span> value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">repeated</span> <span class="token positional-class-name class-name">MapFieldEntry</span> map_field <span class="token operator">=</span> N<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>任何支持映射的protocol buffers实现都必须生成并接受上述定义可以接受的数据。</p> <h2 id="packages"><a href="#packages" class="header-anchor">#</a> Packages</h2> <p>可以向 <code>.proto</code> 文件添加一个可选<code>package</code>说明符，以防止协议消息类型之间的名称冲突。</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">package</span> foo<span class="token punctuation">.</span>bar<span class="token punctuation">;</span>
<span class="token keyword">message</span> <span class="token class-name">Open</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>然后，你可以在定义消息类型的字段时使用package说明符:</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> <span class="token class-name">Foo</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token positional-class-name class-name">foo<span class="token punctuation">.</span>bar<span class="token punctuation">.</span>Open</span> open <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>package 说明符影响生成代码的方式取决于你选择的语言:</p> <ul><li>对于<strong>C++</strong>，产生的类会被包装在C++的命名空间中，如上例中的<code>Open</code>会被封装在 <code>foo::bar</code>空间中；</li> <li>对于<strong>Java</strong>和<strong>Kotlin</strong>，包声明符会变为java的一个包，除非在<code>.proto</code>文件中提供了一个明确有<code>option java_package</code>；</li> <li>对于 <strong>Python</strong>，这个包声明符是被忽略的，因为Python模块是按照其在文件系统中的位置进行组织的</li> <li>对于<strong>Go</strong>，包可以被用做Go包名称，除非你显式的提供一个<code>option go_package</code>在你的<code>.proto</code>文件中。</li> <li>对于<strong>Ruby</strong>，生成的类可以被包装在内置的Ruby名称空间中，转换成Ruby所需的大小写样式 （首字母大写；如果第一个符号不是一个字母，则使用PB_前缀），例如Open会在<code>Foo::Bar</code>名称空间中。</li> <li>在 <strong>C#</strong> 中，包在转换到 PascalCase 后被用作名称空间，除非你在<code>.proto</code>文件中提供<code>option csharp_namespace</code>。例如，<code>Open</code> 将位于<code>Foo.Bar</code>名称空间中。</li></ul> <h4 id="package和名称解析"><a href="#package和名称解析" class="header-anchor">#</a> package和名称解析</h4> <p>在 protocol buffer 语言中，类型名称解析的工作原理类似于 C++ : 首先搜索最内层的作用域，然后搜索下一个最内层的作用域，依此类推，每个包都被认为是其父包的“ inner”。前导的“ .”(例如，<code>.foo.bar.Baz</code>)表示从最外侧的范围开始。</p> <p>protocol buffer 通过解析导入的 <code>.proto</code> 文件来解析所有类型名称。每种语言的代码生成器都知道如何引用该语言中的每种类型，即使它有不同的作用域规则。</p> <h3 id="定义服务"><a href="#定义服务" class="header-anchor">#</a> 定义服务</h3> <p>如果希望将消息类型与 RPC (远程过程调用)系统一起使用，可以在<code>.proto</code> 文件和 protocol buffer 编译器将用你选择的语言生成服务接口代码和存根。因此，例如你希望定义一个 RPC 服务，其方法接受你的 <code>SearchRequest</code>并返回一个 <code>SearchResponse</code>，则可以在<code>.proto</code>文件如下定义。</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">service</span> <span class="token class-name">SearchService</span> <span class="token punctuation">{</span>
  <span class="token keyword">rpc</span> <span class="token function">Search</span><span class="token punctuation">(</span><span class="token class-name">SearchRequest</span><span class="token punctuation">)</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token class-name">SearchResponse</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>使用 protocol buffers 最直接的 RPC 系统是 gRPC，这是 Google 开发的一个语言和平台中立的开源 RPC 系统，可以与 protocol buffers 一起使用。gRPC 特别适用于protocol buffers ，它可以让你直接从你的<code>.proto</code>文件使用特殊的 protocol buffers 编译器插件。</p> <p>如果你不想使用 gRPC，你也可以在你自己的 RPC 实现中使用协议缓冲。你可以在<a href="https://developers.google.com/protocol-buffers/docs/proto#services" target="_blank" rel="noopener noreferrer">《proto2语言指南》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中找到更多相关信息。</p> <p>还有一些正在进行的第三方项目正在开发 RPC 的实施协议缓冲。有关我们所知道的项目的链接列表，请参阅<a href="https://github.com/protocolbuffers/protobuf/blob/master/docs/third_party.md" target="_blank" rel="noopener noreferrer">第三方添加项 wiki 页面<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h2 id="json-映射"><a href="#json-映射" class="header-anchor">#</a> JSON 映射</h2> <p>proto3支持 JSON 的规范编码，使得系统之间更容易共享数据。下表按类型逐一描述了编码。</p> <p>如果 json 编码的数据中缺少某个值，或者该值为 null，那么在解析为 protocol buffer 时，该值将被解释为适当的默认值。如果一个字段在 protocol buffer 中具有默认值，为了节省空间，默认情况下 json 编码的数据中将省略该字段。具体实现可以提供在JSON编码中可选的默认值。</p> <table><thead><tr><th style="text-align:center;">proto3</th> <th style="text-align:center;">JSON</th> <th style="text-align:center;">JSON example</th> <th style="text-align:center;">Notes</th></tr></thead> <tbody><tr><td style="text-align:center;">message</td> <td style="text-align:center;">object</td> <td style="text-align:center;"><code>{&quot;fooBar&quot;: v, &quot;g&quot;: null, …}</code></td> <td style="text-align:center;">Generates JSON objects. Message field names are mapped to lowerCamelCase and become JSON object keys. If the <code>json_name</code> field option is specified, the specified value will be used as the key instead. Parsers accept both the lowerCamelCase name (or the one specified by the <code>json_name</code> option) and the original proto field name. <code>null</code> is an accepted value for all field types and treated as the default value of the corresponding field type.</td></tr> <tr><td style="text-align:center;">enum</td> <td style="text-align:center;">string</td> <td style="text-align:center;"><code>&quot;FOO_BAR&quot;</code></td> <td style="text-align:center;">The name of the enum value as specified in proto is used. Parsers accept both enum names and integer values.</td></tr> <tr><td style="text-align:center;">map</td> <td style="text-align:center;">object</td> <td style="text-align:center;"><code>{&quot;k&quot;: v, …}</code></td> <td style="text-align:center;">All keys are converted to strings.</td></tr> <tr><td style="text-align:center;">repeated V</td> <td style="text-align:center;">array</td> <td style="text-align:center;"><code>[v, …]</code></td> <td style="text-align:center;"><code>null</code> is accepted as the empty list <code>[]</code>.</td></tr> <tr><td style="text-align:center;">bool</td> <td style="text-align:center;">true, false</td> <td style="text-align:center;"><code>true, false</code></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">string</td> <td style="text-align:center;">string</td> <td style="text-align:center;"><code>&quot;Hello World!&quot;</code></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">bytes</td> <td style="text-align:center;">base64 string</td> <td style="text-align:center;"><code>&quot;YWJjMTIzIT8kKiYoKSctPUB+&quot;</code></td> <td style="text-align:center;">JSON value will be the data encoded as a string using standard base64 encoding with paddings. Either standard or URL-safe base64 encoding with/without paddings are accepted.</td></tr> <tr><td style="text-align:center;">int32, fixed32, uint32</td> <td style="text-align:center;">number</td> <td style="text-align:center;"><code>1, -10, 0</code></td> <td style="text-align:center;">JSON value will be a decimal number. Either numbers or strings are accepted.</td></tr> <tr><td style="text-align:center;">int64, fixed64, uint64</td> <td style="text-align:center;">string</td> <td style="text-align:center;"><code>&quot;1&quot;, &quot;-10&quot;</code></td> <td style="text-align:center;">JSON value will be a decimal string. Either numbers or strings are accepted.</td></tr> <tr><td style="text-align:center;">float, double</td> <td style="text-align:center;">number</td> <td style="text-align:center;"><code>1.1, -10.0, 0, &quot;NaN&quot;, &quot;Infinity&quot;</code></td> <td style="text-align:center;">JSON value will be a number or one of the special string values “NaN”, “Infinity”, and “-Infinity”. Either numbers or strings are accepted. Exponent notation is also accepted. -0 is considered equivalent to 0.</td></tr> <tr><td style="text-align:center;">Any</td> <td style="text-align:center;"><code>object</code></td> <td style="text-align:center;"><code>{&quot;@type&quot;: &quot;url&quot;, &quot;f&quot;: v, … }</code></td> <td style="text-align:center;">If the <code>Any</code> contains a value that has a special JSON mapping, it will be converted as follows: <code>{&quot;@type&quot;: xxx, &quot;value&quot;: yyy}</code>. Otherwise, the value will be converted into a JSON object, and the <code>&quot;@type&quot;</code> field will be inserted to indicate the actual data type.</td></tr> <tr><td style="text-align:center;">Timestamp</td> <td style="text-align:center;">string</td> <td style="text-align:center;"><code>&quot;1972-01-01T10:00:20.021Z&quot;</code></td> <td style="text-align:center;">Uses RFC 3339, where generated output will always be Z-normalized and uses 0, 3, 6 or 9 fractional digits. Offsets other than “Z” are also accepted.</td></tr> <tr><td style="text-align:center;">Duration</td> <td style="text-align:center;">string</td> <td style="text-align:center;"><code>&quot;1.000340012s&quot;, &quot;1s&quot;</code></td> <td style="text-align:center;">Generated output always contains 0, 3, 6, or 9 fractional digits, depending on required precision, followed by the suffix “s”. Accepted are any fractional digits (also none) as long as they fit into nano-seconds precision and the suffix “s” is required.</td></tr> <tr><td style="text-align:center;">Struct</td> <td style="text-align:center;"><code>object</code></td> <td style="text-align:center;"><code>{ … }</code></td> <td style="text-align:center;">Any JSON object. See <code>struct.proto</code>.</td></tr> <tr><td style="text-align:center;">Wrapper types</td> <td style="text-align:center;">various types</td> <td style="text-align:center;"><code>2, &quot;2&quot;, &quot;foo&quot;, true, &quot;true&quot;, null, 0, …</code></td> <td style="text-align:center;">Wrappers use the same representation in JSON as the wrapped primitive type, except that <code>null</code> is allowed and preserved during data conversion and transfer.</td></tr> <tr><td style="text-align:center;">FieldMask</td> <td style="text-align:center;">string</td> <td style="text-align:center;"><code>&quot;f.fooBar,h&quot;</code></td> <td style="text-align:center;">See <code>field_mask.proto</code>.</td></tr> <tr><td style="text-align:center;">ListValue</td> <td style="text-align:center;">array</td> <td style="text-align:center;"><code>[foo, bar, …]</code></td> <td style="text-align:center;"></td></tr> <tr><td style="text-align:center;">Value</td> <td style="text-align:center;">value</td> <td style="text-align:center;"></td> <td style="text-align:center;">Any JSON value. Check <a href="https://developers.google.com/protocol-buffers/docs/reference/google.protobuf#google.protobuf.Value" target="_blank" rel="noopener noreferrer">google.protobuf.Value<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for details.</td></tr> <tr><td style="text-align:center;">NullValue</td> <td style="text-align:center;">null</td> <td style="text-align:center;"></td> <td style="text-align:center;">JSON null</td></tr> <tr><td style="text-align:center;">Empty</td> <td style="text-align:center;">object</td> <td style="text-align:center;"><code>{}</code></td> <td style="text-align:center;">An empty JSON object</td></tr></tbody></table> <h4 id="json选项"><a href="#json选项" class="header-anchor">#</a> JSON选项</h4> <p>一个proto3协议 JSON 实现可能提供以下选项:</p> <ul><li>提供默认值的字段：在proto3 JSON 输出中，值为默认值的字段被省略。可以提供一个选项，用默认值覆盖此行为和输出字段。</li> <li>忽略位置字段：在缺省情况下，Proto3 JSON 解析器应该拒绝未知字段，但在解析过程中可能会提供一个忽略未知字段的选项。</li> <li>使用 proto 字段名而不是小驼峰名称：默认情况下，proto3 JSON 打印机应该将字段名转换为 lowerCamelCase，并使用它作为 JSON 名称。可以提供一个选项，用原型字段名作为 JSON 名。需要协议3 JSON 解析器同时接受转换后的 lowerCamelCase 名称和原始字段名称。</li> <li>以整数而不是字符串形式展示枚举值：在 JSON 输出中，默认情况下使用枚举值的名称。可以提供一个选项来代替使用枚举值的数值。</li></ul> <h2 id="options"><a href="#options" class="header-anchor">#</a> Options</h2> <p>Proto 文件中的单个声明可以使用许多选项进行注释。选项不会改变声明的总体含义，但可能会影响在特定上下文中处理声明的方式。可用选项的完整列表在 google/protobuf/descriptor.proto 中定义。</p> <p>有些选项是文件级选项，这意味着它们应该在顶级作用域中编写，而不是在任何消息、枚举或服务定义中。有些选项是消息级选项，这意味着它们应该写在消息定义中。有些选项是字段级选项，这意味着它们应该写在字段定义中。也可以在枚举类型、枚举值、一个字段、服务类型和服务方法上编写选项; 但是，目前对于这些选项都不存在有用的选项。</p> <p>以下是一些最常用的选项:</p> <ul><li><code>java_package</code>（文件选项）：要用于生成的 Java/Kotlin 类的包。如果没有显示在<code>.proto</code>文件中指明<code>java_package</code>，默认会使用proto package名称（在.proto文件中使用package关键字指定的）。然而，proto package 通常不会成为有效的 Java 软件包，因为原始软件包不会以反向域名开始。如果不生成 Java 或 Kotlin 代码，则此选项不起作用。</li></ul> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code>  <span class="token keyword">option</span> java_package <span class="token operator">=</span> <span class="token string">&quot;com.example.foo&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><hr></div> <footer class="page-edit" style="display:none;"><div class="edit-link"><a href="https://github.com/wangwenteng/blog/edit/main/docs/golang/微服务相关/03protov.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页！</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/22/2022, 5:12:44 PM</span></div></footer> <!----> <!----></main> <!----> <div class="comments-wrapper" data-v-4698c43e><div class="valine-wrapper"><div id="valine"></div></div></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-44bd5a18 data-v-44bd5a18><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-44bd5a18><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-44bd5a18></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-44bd5a18></path></svg></div><!----><div></div><!----><div class="reco-bgm-panel" data-v-b1d3339e><audio id="bgm" src="https://music.163.com/song/media/outer/url?id=1480361161.mp3" data-v-b1d3339e></audio> <div class="reco-float-box" style="bottom:200px;z-index:999999;display:none;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><img src="https://p2.music.126.net/qOOTIykbSLw9RHB0vI83GA==/737772302281958.jpg" data-v-b1d3339e></div> <div class="reco-bgm-box" style="left:10px;bottom:10px;z-index:999999;" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="reco-bgm-cover" style="background-image:url(https://p2.music.126.net/qOOTIykbSLw9RHB0vI83GA==/737772302281958.jpg);" data-v-b1d3339e><div class="mini-operation" style="display:none;" data-v-b1d3339e><i class="reco-bgm reco-bgm-pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play" style="display:none;" data-v-b1d3339e></i></div> <div class="falut-message" style="display:none;" data-v-b1d3339e>
          播放失败
        </div></div> <div class="reco-bgm-info" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-music music" data-v-b1d3339e></i>囧架架</div> <div class="info-box" data-v-b1d3339e><i class="reco-bgm reco-bgm-artist" data-v-b1d3339e></i>十三叔</div> <div class="reco-bgm-progress" data-v-b1d3339e><div class="progress-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div> <div class="reco-bgm-operation" data-v-b1d3339e><i class="reco-bgm reco-bgm-last last" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-pause pause" style="display:none;" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-play play" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-next next" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-volume1 volume" data-v-b1d3339e></i> <i class="reco-bgm reco-bgm-mute mute" style="display:none;" data-v-b1d3339e></i> <div class="volume-bar" data-v-b1d3339e><div class="bar" data-v-b1d3339e></div></div></div></div> <div class="reco-bgm-left-box" data-v-b1d3339e data-v-41bcba48 data-v-b1d3339e><i class="reco-bgm reco-bgm-left" data-v-b1d3339e></i></div></div></div></div></div>
    <script src="/assets/js/app.05769872.js" defer></script><script src="/assets/js/4.14868eff.js" defer></script><script src="/assets/js/1.4ea549be.js" defer></script><script src="/assets/js/120.a4ac45ec.js" defer></script><script src="/assets/js/11.fc56e899.js" defer></script>
  </body>
</html>
